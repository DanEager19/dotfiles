!function(n){var t={};function g(e){if(t[e])return t[e].exports;var I=t[e]={i:e,l:!1,exports:{}};return n[e].call(I.exports,I,I.exports,g),I.l=!0,I.exports}g.m=n,g.c=t,g.d=function(n,t,e){g.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},g.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},g.t=function(n,t){if(1&t&&(n=g(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(g.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var I in n)g.d(e,I,function(t){return n[t]}.bind(null,I));return e},g.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return g.d(t,"a",t),t},g.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},g.p="",g(g.s=0)}([function(module,exports){eval("const vscode = acquireVsCodeApi();\nlet fullPageContent = {};\nlet filteredContent = {};\nlet fpcCounter = -1;\nlet filterMatched = false;\nlet schemaColors;\nlet defaultContainer;\nlet isToBottom = false;\nlet isFollowRun = false;\nlet lastScrollTop = 0;\nlet typingTimer;\n\nwindow.addEventListener('message', (event) => {\n    const message = event.data;\n    switch (message.command) {\n        case 'init': {\n            const containers = message.containers;\n            schemaColors = JSON.parse(message.colors);\n            if (containers.length === 1) {\n                defaultContainer = containers[0];\n                return;\n            }\n\n            const containersPanel = document.getElementById('containers-panel');\n            containersPanel.classList.remove('display-none');\n            containersPanel.classList.add('display-inline-block');\n\n            const select = createElement('vscode-select');\n            select.setAttribute('id', 'containers-select');\n            // eslint-disable-next-line @typescript-eslint/prefer-for-of\n            for (let i = 0; i < containers.length; i += 1) {\n                const option = createElement('vscode-option', containers[i], containers[i]);\n                if (i === 0) {\n                    option.setAttribute('selected', '');\n                }\n                select.appendChild(option);\n            }\n            containersPanel.appendChild(select);\n        }\n        case 'content': {\n            const text = message.text.replace(/\\n$/, '');\n            if (!text) {\n                return;\n            }\n            const newContent = text.split('\\n');\n            updateContent(newContent);\n        }\n    }\n});\n\nfunction debounce(func, wait, immediate) {\n    let timeout;\n    return function () {\n        const context = this, args = arguments;\n        const later = function () {\n            timeout = null;\n            if (!immediate) {\n                func.apply(context, args);\n            }\n        };\n        const callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) {\n            func.apply(context, args);\n        }\n    };\n}\n\nfunction createElement(type, value, content) {\n    const element = document.createElement(type);\n    if (value) { element.value = value; }\n    if (content) { element.textContent = content; }\n    return element;\n}\n\nfunction init() {\n    const runBtn = document.getElementById('runBtn');\n    runBtn.addEventListener('click', (_event) => {\n        changeVisibilityAfterRun();\n        startLog();\n    });\n\n    const stopBtn = document.getElementById('stopBtn');\n    stopBtn.addEventListener('click', (_event) => {\n        isFollowRun = false;\n        changeVisibilityAfterStop();\n        stopLog();\n    });\n\n    const clearBtn = document.getElementById('clearBtn');\n    clearBtn.addEventListener('click', (_event) => {\n        changeVisibilityAfterClear();\n        clear();\n    });\n\n    const resetBtn = document.getElementById('resetBtn');\n    resetBtn.addEventListener('click', (_event) => {\n        reset();\n    });\n\n    const bottomBtn = document.getElementById('bottomBtn');\n    bottomBtn.addEventListener('click', (_event) => {\n        scrollToBottom();\n    });\n\n    const wrapChk = document.getElementById('wrap-chk');\n    wrapChk.addEventListener('vsc-change', function (event) {\n        if (event.detail.checked) {\n            document.getElementById('content').classList.remove('white-space-pre');\n            document.getElementById('content').classList.add('white-space-wrap');\n        } else {\n            document.getElementById('content').classList.remove('white-space-wrap');\n            document.getElementById('content').classList.add('white-space-pre');\n        }\n    });\n\n    const filterSelect = document.getElementById('filter-select');\n    filterSelect.addEventListener('vsc-change', (_event) => {\n        resetFilter();\n        if (isRun() && document.getElementById('filter-input').value) {\n            runFilter();\n        }\n    });\n\n    const filterInput = document.getElementById('filter-input');\n    filterInput.addEventListener('keyup', (_event) => {\n        resetFilter();\n        if (!isRun() || document.getElementById('filter-select').value === 'all') {\n            return;\n        }\n        if (typingTimer) {\n            clearTimeout(typingTimer);\n        }\n        typingTimer = setTimeout(runFilter, 500);\n    });\n\n    const logPanel = document.getElementById('logPanel');\n    const toBottom = debounce(function () {\n        const st = logPanel.scrollTop;\n        if (st > lastScrollTop) {\n            // scroll down\n            isToBottom = (logPanel.scrollTop + window.innerHeight) >= logPanel.scrollHeight;\n        } else {\n            // scroll up\n            isToBottom = false;\n        }\n        lastScrollTop = st <= 0 ? 0 : st;\n        renderByPagination();\n    }, 250);\n    logPanel.addEventListener(\"scroll\", toBottom);\n}\n\nfunction resetContent() {\n    fullPageContent = {};\n    fpcCounter = -1;\n}\n\nfunction resetFilter() {\n    filteredContent = {};\n    filterMatched = false;\n}\n\nfunction runFilter() {\n    emptyContent();\n    saveFilteredContent();\n    setHeightContentPanel();\n    renderByPagination();\n}\n\nfunction changeVisibilityAfterRun() {\n    if (getToTerminal()) {\n        return;\n    }\n    document.getElementById('runBtn').classList.add('display-none');\n    if (isFollow()) {\n        switchClass('stopBtn', 'display-none', 'display-inline-block');\n    }\n    switchClass('clearBtn', 'display-none', 'display-inline-block');\n}\n\nfunction changeVisibilityAfterClear() {\n    if (document.getElementById('stopBtn').classList.contains('display-none')) {\n        switchClass('clearBtn', 'display-inline-block', 'display-none');\n        switchClass('runBtn', 'display-none', 'display-inline-block');\n    }\n}\n\nfunction changeVisibilityAfterStop() {\n    switchClass('stopBtn', 'display-inline-block', 'display-none');\n}\n\nfunction switchClass(id, classToRemove, classToAdd) {\n    const element = document.getElementById(id);\n    if (element.classList.contains(classToRemove)) {\n        element.classList.remove(classToRemove);\n    }\n    if (!element.classList.contains(classToAdd)) {\n        element.classList.add(classToAdd);\n    }\n}\n\nfunction isRun() {\n    return document.getElementById('runBtn').classList.contains('display-none');\n}\n\nfunction isFilterEnabled() {\n    const filterInput = document.getElementById('filter-input').value;\n    const mode = document.getElementById('filter-select').value;\n    return filterInput.length > 0 && mode !== 'all';\n}\n\nfunction startLog() {\n    resetContent();\n    resetFilter();\n    clear();\n    isFollowRun = isFollow();\n    const options = {\n        container: getContainer(),\n        follow: isFollowRun,\n        timestamp: document.getElementById('timestamp-chk').checked,\n        since: getSinceDuration(),\n        tail: getTail(),\n        terminal: getToTerminal()\n    };\n    vscode.postMessage({\n        command: 'start',\n        options: JSON.stringify(options)\n    });\n}\n\nfunction stopLog() {\n    vscode.postMessage({\n        command: 'stop'\n    });\n}\n\nfunction clear() {\n    if (!isFollowRun) {\n        resetContent();\n        resetFilter();\n    }\n    setHeightContentPanel(true);\n    emptyContent();\n}\n\nfunction reset() {\n    const containersSelect = document.getElementById('containers-select');\n    if (containersSelect) {\n        containersSelect.selectedIndex = 0;\n    }\n    document.getElementById('follow-chk').checked = false;\n    document.getElementById('timestamp-chk').checked = false;\n    document.getElementById('since-input').value = '0';\n    document.getElementById('since-select').selectedIndex = 0;\n    document.getElementById('tail-input').value = '-1';\n    document.getElementById('terminal-chk').checked = false;\n}\n\nfunction updateContent(newContent) {\n    let content = {};\n    let counter = 0;\n\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < newContent.length; i += 1) {\n        if (newContent[i].length > 0) {\n            content[counter] = newContent[i];\n            fpcCounter++;\n            fullPageContent[fpcCounter] = newContent[i];\n            counter++;\n        }\n    }\n    content = saveFilteredContent(content);\n    setHeightContentPanel();\n    renderByPagination(content);\n    switchClass('clearBtn', 'display-none', 'display-inline-block');\n}\n\nfunction setHeightContentPanel(removeStyle) {\n    if (removeStyle) {\n        document.getElementById('innerLogPanel').style.removeProperty('height');\n    } else {\n        const content = isFilterEnabled() ? filteredContent : fullPageContent;\n        const rows = Object.keys(content).length;\n        const heightDiv = getDefaultDivHeightValue();\n        document.getElementById('innerLogPanel').style.height = `${heightDiv * rows}px`;\n    }\n}\n\nfunction saveFilteredContent(content) {\n    const filterInput = document.getElementById('filter-input').value;\n    const mode = document.getElementById('filter-select').value;\n    let contentAfterFilter;\n    if (filterInput.length > 0 && mode !== 'all') {\n        contentAfterFilter = filter(content);\n        let fcRows = Object.keys(filteredContent).length - 1;\n        if (fcRows === -1) {\n            filteredContent = contentAfterFilter;\n            return contentAfterFilter;\n        }\n        for (let i = 0; i < Object.keys(contentAfterFilter).length; i += 1) {\n            fcRows++;\n            filteredContent[fcRows] = contentAfterFilter[i];\n        }\n    }\n    return contentAfterFilter;\n}\n\nfunction filter(logs) {\n    const text = logs ? logs : fullPageContent;\n    const filterInput = document.getElementById('filter-input').value;\n    const mode = document.getElementById('filter-select').value;\n    let content = {};\n    if (filterInput.length > 0 && mode !== 'all') {\n        const regex = new RegExp(filterInput);\n        switch (mode) {\n            case 'include':\n                content = filterByFunction(text, (value) => regex.test(value));\n                break;\n            case 'exclude':\n                content = filterByFunction(text, (value) => !regex.test(value));\n                break;\n            case 'before':\n                if (!filterMatched) {\n                    const filterBeforeResult = filterBefore(text, regex);\n                    content = filterBeforeResult.content;\n                    filterMatched = filterBeforeResult.matched;\n                }\n                break;\n            case 'after':\n                if (!filterMatched) {\n                    const filterAfterResult = filterAfter(text, regex);\n                    content = filterAfterResult.content;\n                    filterMatched = filterAfterResult.matched;\n                } else {\n                    content = text;\n                }\n                break;\n            default:\n                break;\n        }\n    } else {\n        content = text;\n    }\n\n    return content;\n}\n\nfunction filterByFunction(text, func) {\n    const content = {};\n    let counter = 0;\n    let innerCounter = 0;\n    while (true) {\n        const value = text[counter];\n        if (!value) {\n            break;\n        }\n        if (func(value)) {\n            content[innerCounter] = value;\n            innerCounter++;\n        }\n        counter++;\n    }\n    return content;\n}\n\nfunction filterBefore(text, regex) {\n    const content = {};\n    let counter = 0;\n    let matched = false;\n    while (true) {\n        const value = text[counter];\n        matched = regex.test(value);\n        if (!value || matched) {\n            break;\n        }\n        content[counter] = value;\n        counter++;\n    }\n    return { matched, content };\n}\n\nfunction filterAfter(text, regex) {\n    const content = {};\n    let counter = 0;\n    let innerCounter = 0;\n    let start = false;\n    let matched = false;\n    while (true) {\n        const value = text[counter];\n        if (!value) {\n            break;\n        }\n        matched = regex.test(value);\n        if (!start && matched) {\n            start = true;\n        }\n        if (start) {\n            content[innerCounter] = value;\n            innerCounter++;\n        }\n        counter++;\n    }\n    return { matched, content };\n}\n\nfunction emptyContent() {\n    const contentDiv = document.getElementById('innerLogPanel');\n    let i = contentDiv.childNodes.length;\n    while (i--) {\n        contentDiv.removeChild(contentDiv.firstChild);\n    }\n    contentDiv.innerHTML = `<code id='content' class='${isWrapEnabled() ? 'white-space-wrap' : 'white-space-pre'} position-relative'></code>`;\n}\n\nfunction renderByPagination(contentToAdd) {\n    if (contentToAdd && Object.keys(contentToAdd).length === 0) {\n        return;\n    }\n    const fullFilteredContent = isFilterEnabled() ? filteredContent : fullPageContent;\n    const totalRows = Object.keys(fullFilteredContent).length - 1;\n    const heightDiv = getDefaultDivHeightValue();\n    const currentPosition = document.getElementById('logPanel').scrollTop;\n    const referenceRow = Math.floor(currentPosition / heightDiv);\n    // identify rows range to draw\n    let lowerRange = referenceRow - 250 < 0 ? 0 : referenceRow - 250;\n    let upperRange = referenceRow + 250 > totalRows ? totalRows : referenceRow + 250;\n    let isPrepend = false;\n\n    const children = document.getElementById('content').children;\n    if (children.length !== 0) {\n        // identify rows range present in DOM\n        const lowestRowInDOM = parseInt(children.item(0).id);\n        const uppestRowInDOM = parseInt(children.item(children.length - 1).id);\n        if (lowerRange < lowestRowInDOM) {\n            if (upperRange >= lowestRowInDOM) {\n                removeChildren(upperRange + 1, uppestRowInDOM);\n                upperRange = lowestRowInDOM - 1;\n                isPrepend = true;\n                document.getElementById('content').style.top = `${lowerRange * heightDiv}px`;\n            } else {\n                emptyContent();\n                document.getElementById('content').style.top = `${lowerRange * heightDiv}px`;\n            }\n            const content = extractRowsToDraw(fullFilteredContent, lowerRange, upperRange);\n            render(beautifyLines(content), lowerRange, isPrepend);\n        } else if (upperRange > uppestRowInDOM) {\n            if (lowerRange <= uppestRowInDOM) {\n                removeChildren(lowestRowInDOM, lowerRange - 1);\n                document.getElementById('content').style.top = `${lowerRange * heightDiv}px`;\n                lowerRange = uppestRowInDOM + 1;\n            } else {\n                emptyContent();\n                document.getElementById('content').style.top = `${lowerRange * heightDiv}px`;\n            }\n            const content = extractRowsToDraw(fullFilteredContent, lowerRange, upperRange);\n            render(beautifyLines(content), lowerRange, isPrepend);\n        }\n    } else {\n        const content = extractRowsToDraw(fullFilteredContent, lowerRange, upperRange);\n        document.getElementById('content').style.top = `${lowerRange * heightDiv}px`;\n        render(beautifyLines(content), lowerRange, isPrepend);\n    }\n}\n\nfunction extractRowsToDraw(content, from, to) {\n    const contentExtracted = {};\n    for (let i = from; i <= to; i += 1) {\n        contentExtracted[i] = content[i];\n    }\n    return contentExtracted;\n}\n\nfunction beautifyLines(contentLines) {\n    const content = {};\n    if (Object.keys(contentLines).length === 0) {\n        return content;\n    }\n\n    const heightDiv = getDefaultDivHeightValue();\n    // eslint-disable-next-line prefer-const\n    for (let [key, value] of Object.entries(contentLines)) {\n        if (!value) {\n            continue;\n        }\n        value = value.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n        value = highlightWords(value);\n        value = /\\n$/.test(value) ? value : `${value}\\n`;\n        content[key] = `<div id=\"${key}\" style=\"min-height: ${heightDiv}px\">${value}</div>`;\n    }\n    return content;\n}\n\nfunction highlightWords(row) {\n    if (!schemaColors) {\n        return row;\n    }\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < schemaColors.length; i += 1) {\n        const rule = schemaColors[i];\n        const regexp = new RegExp(rule.regex, \"gi\");\n        if (regexp.test(row)) {\n            row = row.replaceAll(regexp, repl);\n            row = row.replaceAll('#ruleColor', rule.color);\n        }\n    }\n    return row;\n}\n\nfunction repl() {\n    const match = arguments[0];\n    const offset = arguments[arguments.length - 2];\n    const originalString = arguments[arguments.length - 1];\n    if (!originalString) {\n        return match;\n    }\n    const indexOpenSpan = originalString.substring(0, offset + match.length).lastIndexOf(\"<span\");\n    const indexCloseSpan = originalString.substring(0, offset + match.length).lastIndexOf(\"</span>\");\n    if (indexOpenSpan === -1 || indexOpenSpan < indexCloseSpan) {\n        return `<span class=\"#ruleColor\">${match}</span>`;\n    } else {\n        return match;\n    }\n}\n\nfunction removeChildren(from, to) {\n    if (to < from) {\n        return;\n    }\n    for (let i=from; i<=to; i++) {\n        const toDelete = document.getElementById(i.toString());\n        if (toDelete) {\n            toDelete.remove();\n        }\n    }\n}\n\nfunction render(content, from, prepend) {\n    if (Object.keys(content).length === 0) {\n        const fragment = document.createRange().createContextualFragment('No logs ...');\n        document.getElementById('content').appendChild(fragment);\n    } else {\n        const contentToDisplay = concatenateObjectValuesAsString(content, from);\n        const fragment = document.createRange().createContextualFragment(contentToDisplay);\n        if (prepend) {\n            document.getElementById('content').prepend(fragment);\n        } else {\n            document.getElementById('content').appendChild(fragment);\n        }\n        if (isToBottom) {\n            scrollToBottom();\n        }\n    }\n}\n\nfunction concatenateObjectValuesAsString(object, ix) {\n    let valuesConcatenated = '';\n    while (true) {\n        const value = object[ix];\n        if (!value) {\n            break;\n        }\n        valuesConcatenated += value;\n        ix++;\n    }\n    return valuesConcatenated;\n}\n\nfunction scrollToBottom() {\n    document.getElementById('bottom').scrollIntoView();\n}\n\nfunction getContainer() {\n    const containersSelect = document.getElementById('containers-select');\n    if (containersSelect) {\n        return containersSelect.value;\n    }\n    return defaultContainer;\n}\n\nfunction isFollow() {\n    return document.getElementById('follow-chk').checked;\n}\n\nfunction getSinceDuration() {\n    const sinceType = document.getElementById('since-select').value;\n    const sinceInput = document.getElementById('since-input').value;\n    if (isNaN(sinceInput) || sinceInput <= 0 || sinceType.trim() === '') {\n        return 0;\n    }\n    return `${sinceInput}${sinceType}`;\n}\n\nfunction getTail() {\n    const tailValue = document.getElementById('tail-input').value;\n    if (isNaN(tailValue) || tailValue <= 0) {\n        return -1;\n    }\n    return tailValue;\n}\n\nfunction getToTerminal() {\n    return document.getElementById('terminal-chk').checked;\n}\n\nfunction isWrapEnabled() {\n    return document.getElementById('wrap-chk').checked;\n}\n\nfunction getDefaultDivHeightValue() {\n    return document.getElementById('follow-lbl').offsetHeight;\n}\n\n(function () {\n    init();\n})();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9sb2dzL2FwcC9tYWluLmpzP2ZiMzYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHVCQUF1QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQix1QkFBdUI7QUFDdkMsa0JBQWtCLCtCQUErQjtBQUNqRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQkFBbUIsdUJBQXVCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLGlCQUFpQjtBQUNwRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsNENBQTRDO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELHlEQUF5RDtBQUNqSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSx1QkFBdUI7QUFDekYsYUFBYTtBQUNiO0FBQ0Esa0VBQWtFLHVCQUF1QjtBQUN6RjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLGtFQUFrRSx1QkFBdUI7QUFDekY7QUFDQSxhQUFhO0FBQ2I7QUFDQSxrRUFBa0UsdUJBQXVCO0FBQ3pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsMERBQTBELHVCQUF1QjtBQUNqRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHNCQUFzQixTQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLHNCQUFzQjtBQUMvRDtBQUNBLCtDQUErQyxNQUFNO0FBQ3JELG1DQUFtQyxJQUFJLHVCQUF1QixVQUFVLE1BQU0sTUFBTTtBQUNwRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQix5QkFBeUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLE1BQU07QUFDakQsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLFdBQVcsRUFBRSxVQUFVO0FBQ3JDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxDQUFDIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB2c2NvZGUgPSBhY3F1aXJlVnNDb2RlQXBpKCk7XG5sZXQgZnVsbFBhZ2VDb250ZW50ID0ge307XG5sZXQgZmlsdGVyZWRDb250ZW50ID0ge307XG5sZXQgZnBjQ291bnRlciA9IC0xO1xubGV0IGZpbHRlck1hdGNoZWQgPSBmYWxzZTtcbmxldCBzY2hlbWFDb2xvcnM7XG5sZXQgZGVmYXVsdENvbnRhaW5lcjtcbmxldCBpc1RvQm90dG9tID0gZmFsc2U7XG5sZXQgaXNGb2xsb3dSdW4gPSBmYWxzZTtcbmxldCBsYXN0U2Nyb2xsVG9wID0gMDtcbmxldCB0eXBpbmdUaW1lcjtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBtZXNzYWdlID0gZXZlbnQuZGF0YTtcbiAgICBzd2l0Y2ggKG1lc3NhZ2UuY29tbWFuZCkge1xuICAgICAgICBjYXNlICdpbml0Jzoge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVycyA9IG1lc3NhZ2UuY29udGFpbmVycztcbiAgICAgICAgICAgIHNjaGVtYUNvbG9ycyA9IEpTT04ucGFyc2UobWVzc2FnZS5jb2xvcnMpO1xuICAgICAgICAgICAgaWYgKGNvbnRhaW5lcnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdENvbnRhaW5lciA9IGNvbnRhaW5lcnNbMF07XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXJzUGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVycy1wYW5lbCcpO1xuICAgICAgICAgICAgY29udGFpbmVyc1BhbmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc3BsYXktbm9uZScpO1xuICAgICAgICAgICAgY29udGFpbmVyc1BhbmVsLmNsYXNzTGlzdC5hZGQoJ2Rpc3BsYXktaW5saW5lLWJsb2NrJyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdCA9IGNyZWF0ZUVsZW1lbnQoJ3ZzY29kZS1zZWxlY3QnKTtcbiAgICAgICAgICAgIHNlbGVjdC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2NvbnRhaW5lcnMtc2VsZWN0Jyk7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3ByZWZlci1mb3Itb2ZcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29udGFpbmVycy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGNyZWF0ZUVsZW1lbnQoJ3ZzY29kZS1vcHRpb24nLCBjb250YWluZXJzW2ldLCBjb250YWluZXJzW2ldKTtcbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250YWluZXJzUGFuZWwuYXBwZW5kQ2hpbGQoc2VsZWN0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdjb250ZW50Jzoge1xuICAgICAgICAgICAgY29uc3QgdGV4dCA9IG1lc3NhZ2UudGV4dC5yZXBsYWNlKC9cXG4kLywgJycpO1xuICAgICAgICAgICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmV3Q29udGVudCA9IHRleHQuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgdXBkYXRlQ29udGVudChuZXdDb250ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5mdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHtcbiAgICBsZXQgdGltZW91dDtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgY29uc3QgbGF0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICAgIGlmICghaW1tZWRpYXRlKSB7XG4gICAgICAgICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgY2FsbE5vdyA9IGltbWVkaWF0ZSAmJiAhdGltZW91dDtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG4gICAgICAgIGlmIChjYWxsTm93KSB7XG4gICAgICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0eXBlLCB2YWx1ZSwgY29udGVudCkge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHR5cGUpO1xuICAgIGlmICh2YWx1ZSkgeyBlbGVtZW50LnZhbHVlID0gdmFsdWU7IH1cbiAgICBpZiAoY29udGVudCkgeyBlbGVtZW50LnRleHRDb250ZW50ID0gY29udGVudDsgfVxuICAgIHJldHVybiBlbGVtZW50O1xufVxuXG5mdW5jdGlvbiBpbml0KCkge1xuICAgIGNvbnN0IHJ1bkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdydW5CdG4nKTtcbiAgICBydW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoX2V2ZW50KSA9PiB7XG4gICAgICAgIGNoYW5nZVZpc2liaWxpdHlBZnRlclJ1bigpO1xuICAgICAgICBzdGFydExvZygpO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc3RvcEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wQnRuJyk7XG4gICAgc3RvcEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChfZXZlbnQpID0+IHtcbiAgICAgICAgaXNGb2xsb3dSdW4gPSBmYWxzZTtcbiAgICAgICAgY2hhbmdlVmlzaWJpbGl0eUFmdGVyU3RvcCgpO1xuICAgICAgICBzdG9wTG9nKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjbGVhckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhckJ0bicpO1xuICAgIGNsZWFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKF9ldmVudCkgPT4ge1xuICAgICAgICBjaGFuZ2VWaXNpYmlsaXR5QWZ0ZXJDbGVhcigpO1xuICAgICAgICBjbGVhcigpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzZXRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzZXRCdG4nKTtcbiAgICByZXNldEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChfZXZlbnQpID0+IHtcbiAgICAgICAgcmVzZXQoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGJvdHRvbUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3R0b21CdG4nKTtcbiAgICBib3R0b21CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoX2V2ZW50KSA9PiB7XG4gICAgICAgIHNjcm9sbFRvQm90dG9tKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCB3cmFwQ2hrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyYXAtY2hrJyk7XG4gICAgd3JhcENoay5hZGRFdmVudExpc3RlbmVyKCd2c2MtY2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5kZXRhaWwuY2hlY2tlZCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5jbGFzc0xpc3QucmVtb3ZlKCd3aGl0ZS1zcGFjZS1wcmUnKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50JykuY2xhc3NMaXN0LmFkZCgnd2hpdGUtc3BhY2Utd3JhcCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5jbGFzc0xpc3QucmVtb3ZlKCd3aGl0ZS1zcGFjZS13cmFwJyk7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGVudCcpLmNsYXNzTGlzdC5hZGQoJ3doaXRlLXNwYWNlLXByZScpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBmaWx0ZXJTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLXNlbGVjdCcpO1xuICAgIGZpbHRlclNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCd2c2MtY2hhbmdlJywgKF9ldmVudCkgPT4ge1xuICAgICAgICByZXNldEZpbHRlcigpO1xuICAgICAgICBpZiAoaXNSdW4oKSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWlucHV0JykudmFsdWUpIHtcbiAgICAgICAgICAgIHJ1bkZpbHRlcigpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBmaWx0ZXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItaW5wdXQnKTtcbiAgICBmaWx0ZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChfZXZlbnQpID0+IHtcbiAgICAgICAgcmVzZXRGaWx0ZXIoKTtcbiAgICAgICAgaWYgKCFpc1J1bigpIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItc2VsZWN0JykudmFsdWUgPT09ICdhbGwnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGluZ1RpbWVyKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodHlwaW5nVGltZXIpO1xuICAgICAgICB9XG4gICAgICAgIHR5cGluZ1RpbWVyID0gc2V0VGltZW91dChydW5GaWx0ZXIsIDUwMCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBsb2dQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dQYW5lbCcpO1xuICAgIGNvbnN0IHRvQm90dG9tID0gZGVib3VuY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBzdCA9IGxvZ1BhbmVsLnNjcm9sbFRvcDtcbiAgICAgICAgaWYgKHN0ID4gbGFzdFNjcm9sbFRvcCkge1xuICAgICAgICAgICAgLy8gc2Nyb2xsIGRvd25cbiAgICAgICAgICAgIGlzVG9Cb3R0b20gPSAobG9nUGFuZWwuc2Nyb2xsVG9wICsgd2luZG93LmlubmVySGVpZ2h0KSA+PSBsb2dQYW5lbC5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBzY3JvbGwgdXBcbiAgICAgICAgICAgIGlzVG9Cb3R0b20gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBsYXN0U2Nyb2xsVG9wID0gc3QgPD0gMCA/IDAgOiBzdDtcbiAgICAgICAgcmVuZGVyQnlQYWdpbmF0aW9uKCk7XG4gICAgfSwgMjUwKTtcbiAgICBsb2dQYW5lbC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRvQm90dG9tKTtcbn1cblxuZnVuY3Rpb24gcmVzZXRDb250ZW50KCkge1xuICAgIGZ1bGxQYWdlQ29udGVudCA9IHt9O1xuICAgIGZwY0NvdW50ZXIgPSAtMTtcbn1cblxuZnVuY3Rpb24gcmVzZXRGaWx0ZXIoKSB7XG4gICAgZmlsdGVyZWRDb250ZW50ID0ge307XG4gICAgZmlsdGVyTWF0Y2hlZCA9IGZhbHNlO1xufVxuXG5mdW5jdGlvbiBydW5GaWx0ZXIoKSB7XG4gICAgZW1wdHlDb250ZW50KCk7XG4gICAgc2F2ZUZpbHRlcmVkQ29udGVudCgpO1xuICAgIHNldEhlaWdodENvbnRlbnRQYW5lbCgpO1xuICAgIHJlbmRlckJ5UGFnaW5hdGlvbigpO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VWaXNpYmlsaXR5QWZ0ZXJSdW4oKSB7XG4gICAgaWYgKGdldFRvVGVybWluYWwoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdydW5CdG4nKS5jbGFzc0xpc3QuYWRkKCdkaXNwbGF5LW5vbmUnKTtcbiAgICBpZiAoaXNGb2xsb3coKSkge1xuICAgICAgICBzd2l0Y2hDbGFzcygnc3RvcEJ0bicsICdkaXNwbGF5LW5vbmUnLCAnZGlzcGxheS1pbmxpbmUtYmxvY2snKTtcbiAgICB9XG4gICAgc3dpdGNoQ2xhc3MoJ2NsZWFyQnRuJywgJ2Rpc3BsYXktbm9uZScsICdkaXNwbGF5LWlubGluZS1ibG9jaycpO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VWaXNpYmlsaXR5QWZ0ZXJDbGVhcigpIHtcbiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3BCdG4nKS5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc3BsYXktbm9uZScpKSB7XG4gICAgICAgIHN3aXRjaENsYXNzKCdjbGVhckJ0bicsICdkaXNwbGF5LWlubGluZS1ibG9jaycsICdkaXNwbGF5LW5vbmUnKTtcbiAgICAgICAgc3dpdGNoQ2xhc3MoJ3J1bkJ0bicsICdkaXNwbGF5LW5vbmUnLCAnZGlzcGxheS1pbmxpbmUtYmxvY2snKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNoYW5nZVZpc2liaWxpdHlBZnRlclN0b3AoKSB7XG4gICAgc3dpdGNoQ2xhc3MoJ3N0b3BCdG4nLCAnZGlzcGxheS1pbmxpbmUtYmxvY2snLCAnZGlzcGxheS1ub25lJyk7XG59XG5cbmZ1bmN0aW9uIHN3aXRjaENsYXNzKGlkLCBjbGFzc1RvUmVtb3ZlLCBjbGFzc1RvQWRkKSB7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbiAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NUb1JlbW92ZSkpIHtcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzVG9SZW1vdmUpO1xuICAgIH1cbiAgICBpZiAoIWVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzVG9BZGQpKSB7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc1RvQWRkKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGlzUnVuKCkge1xuICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuQnRuJykuY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNwbGF5LW5vbmUnKTtcbn1cblxuZnVuY3Rpb24gaXNGaWx0ZXJFbmFibGVkKCkge1xuICAgIGNvbnN0IGZpbHRlcklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1pbnB1dCcpLnZhbHVlO1xuICAgIGNvbnN0IG1vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLXNlbGVjdCcpLnZhbHVlO1xuICAgIHJldHVybiBmaWx0ZXJJbnB1dC5sZW5ndGggPiAwICYmIG1vZGUgIT09ICdhbGwnO1xufVxuXG5mdW5jdGlvbiBzdGFydExvZygpIHtcbiAgICByZXNldENvbnRlbnQoKTtcbiAgICByZXNldEZpbHRlcigpO1xuICAgIGNsZWFyKCk7XG4gICAgaXNGb2xsb3dSdW4gPSBpc0ZvbGxvdygpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGNvbnRhaW5lcjogZ2V0Q29udGFpbmVyKCksXG4gICAgICAgIGZvbGxvdzogaXNGb2xsb3dSdW4sXG4gICAgICAgIHRpbWVzdGFtcDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVzdGFtcC1jaGsnKS5jaGVja2VkLFxuICAgICAgICBzaW5jZTogZ2V0U2luY2VEdXJhdGlvbigpLFxuICAgICAgICB0YWlsOiBnZXRUYWlsKCksXG4gICAgICAgIHRlcm1pbmFsOiBnZXRUb1Rlcm1pbmFsKClcbiAgICB9O1xuICAgIHZzY29kZS5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGNvbW1hbmQ6ICdzdGFydCcsXG4gICAgICAgIG9wdGlvbnM6IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHN0b3BMb2coKSB7XG4gICAgdnNjb2RlLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgY29tbWFuZDogJ3N0b3AnXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIGlmICghaXNGb2xsb3dSdW4pIHtcbiAgICAgICAgcmVzZXRDb250ZW50KCk7XG4gICAgICAgIHJlc2V0RmlsdGVyKCk7XG4gICAgfVxuICAgIHNldEhlaWdodENvbnRlbnRQYW5lbCh0cnVlKTtcbiAgICBlbXB0eUNvbnRlbnQoKTtcbn1cblxuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgY29uc3QgY29udGFpbmVyc1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXJzLXNlbGVjdCcpO1xuICAgIGlmIChjb250YWluZXJzU2VsZWN0KSB7XG4gICAgICAgIGNvbnRhaW5lcnNTZWxlY3Quc2VsZWN0ZWRJbmRleCA9IDA7XG4gICAgfVxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xsb3ctY2hrJykuY2hlY2tlZCA9IGZhbHNlO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aW1lc3RhbXAtY2hrJykuY2hlY2tlZCA9IGZhbHNlO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaW5jZS1pbnB1dCcpLnZhbHVlID0gJzAnO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaW5jZS1zZWxlY3QnKS5zZWxlY3RlZEluZGV4ID0gMDtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFpbC1pbnB1dCcpLnZhbHVlID0gJy0xJztcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVybWluYWwtY2hrJykuY2hlY2tlZCA9IGZhbHNlO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVDb250ZW50KG5ld0NvbnRlbnQpIHtcbiAgICBsZXQgY29udGVudCA9IHt9O1xuICAgIGxldCBjb3VudGVyID0gMDtcblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvcHJlZmVyLWZvci1vZlxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3Q29udGVudC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBpZiAobmV3Q29udGVudFtpXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb250ZW50W2NvdW50ZXJdID0gbmV3Q29udGVudFtpXTtcbiAgICAgICAgICAgIGZwY0NvdW50ZXIrKztcbiAgICAgICAgICAgIGZ1bGxQYWdlQ29udGVudFtmcGNDb3VudGVyXSA9IG5ld0NvbnRlbnRbaV07XG4gICAgICAgICAgICBjb3VudGVyKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udGVudCA9IHNhdmVGaWx0ZXJlZENvbnRlbnQoY29udGVudCk7XG4gICAgc2V0SGVpZ2h0Q29udGVudFBhbmVsKCk7XG4gICAgcmVuZGVyQnlQYWdpbmF0aW9uKGNvbnRlbnQpO1xuICAgIHN3aXRjaENsYXNzKCdjbGVhckJ0bicsICdkaXNwbGF5LW5vbmUnLCAnZGlzcGxheS1pbmxpbmUtYmxvY2snKTtcbn1cblxuZnVuY3Rpb24gc2V0SGVpZ2h0Q29udGVudFBhbmVsKHJlbW92ZVN0eWxlKSB7XG4gICAgaWYgKHJlbW92ZVN0eWxlKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbm5lckxvZ1BhbmVsJykuc3R5bGUucmVtb3ZlUHJvcGVydHkoJ2hlaWdodCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBpc0ZpbHRlckVuYWJsZWQoKSA/IGZpbHRlcmVkQ29udGVudCA6IGZ1bGxQYWdlQ29udGVudDtcbiAgICAgICAgY29uc3Qgcm93cyA9IE9iamVjdC5rZXlzKGNvbnRlbnQpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgaGVpZ2h0RGl2ID0gZ2V0RGVmYXVsdERpdkhlaWdodFZhbHVlKCk7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbm5lckxvZ1BhbmVsJykuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0RGl2ICogcm93c31weGA7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBzYXZlRmlsdGVyZWRDb250ZW50KGNvbnRlbnQpIHtcbiAgICBjb25zdCBmaWx0ZXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItaW5wdXQnKS52YWx1ZTtcbiAgICBjb25zdCBtb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1zZWxlY3QnKS52YWx1ZTtcbiAgICBsZXQgY29udGVudEFmdGVyRmlsdGVyO1xuICAgIGlmIChmaWx0ZXJJbnB1dC5sZW5ndGggPiAwICYmIG1vZGUgIT09ICdhbGwnKSB7XG4gICAgICAgIGNvbnRlbnRBZnRlckZpbHRlciA9IGZpbHRlcihjb250ZW50KTtcbiAgICAgICAgbGV0IGZjUm93cyA9IE9iamVjdC5rZXlzKGZpbHRlcmVkQ29udGVudCkubGVuZ3RoIC0gMTtcbiAgICAgICAgaWYgKGZjUm93cyA9PT0gLTEpIHtcbiAgICAgICAgICAgIGZpbHRlcmVkQ29udGVudCA9IGNvbnRlbnRBZnRlckZpbHRlcjtcbiAgICAgICAgICAgIHJldHVybiBjb250ZW50QWZ0ZXJGaWx0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBPYmplY3Qua2V5cyhjb250ZW50QWZ0ZXJGaWx0ZXIpLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBmY1Jvd3MrKztcbiAgICAgICAgICAgIGZpbHRlcmVkQ29udGVudFtmY1Jvd3NdID0gY29udGVudEFmdGVyRmlsdGVyW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50QWZ0ZXJGaWx0ZXI7XG59XG5cbmZ1bmN0aW9uIGZpbHRlcihsb2dzKSB7XG4gICAgY29uc3QgdGV4dCA9IGxvZ3MgPyBsb2dzIDogZnVsbFBhZ2VDb250ZW50O1xuICAgIGNvbnN0IGZpbHRlcklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1pbnB1dCcpLnZhbHVlO1xuICAgIGNvbnN0IG1vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLXNlbGVjdCcpLnZhbHVlO1xuICAgIGxldCBjb250ZW50ID0ge307XG4gICAgaWYgKGZpbHRlcklucHV0Lmxlbmd0aCA+IDAgJiYgbW9kZSAhPT0gJ2FsbCcpIHtcbiAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGZpbHRlcklucHV0KTtcbiAgICAgICAgc3dpdGNoIChtb2RlKSB7XG4gICAgICAgICAgICBjYXNlICdpbmNsdWRlJzpcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gZmlsdGVyQnlGdW5jdGlvbih0ZXh0LCAodmFsdWUpID0+IHJlZ2V4LnRlc3QodmFsdWUpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2V4Y2x1ZGUnOlxuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBmaWx0ZXJCeUZ1bmN0aW9uKHRleHQsICh2YWx1ZSkgPT4gIXJlZ2V4LnRlc3QodmFsdWUpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JlZm9yZSc6XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJNYXRjaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbHRlckJlZm9yZVJlc3VsdCA9IGZpbHRlckJlZm9yZSh0ZXh0LCByZWdleCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBmaWx0ZXJCZWZvcmVSZXN1bHQuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyTWF0Y2hlZCA9IGZpbHRlckJlZm9yZVJlc3VsdC5tYXRjaGVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2FmdGVyJzpcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlck1hdGNoZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyQWZ0ZXJSZXN1bHQgPSBmaWx0ZXJBZnRlcih0ZXh0LCByZWdleCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBmaWx0ZXJBZnRlclJlc3VsdC5jb250ZW50O1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJNYXRjaGVkID0gZmlsdGVyQWZ0ZXJSZXN1bHQubWF0Y2hlZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdGV4dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29udGVudCA9IHRleHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbnRlbnQ7XG59XG5cbmZ1bmN0aW9uIGZpbHRlckJ5RnVuY3Rpb24odGV4dCwgZnVuYykge1xuICAgIGNvbnN0IGNvbnRlbnQgPSB7fTtcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgbGV0IGlubmVyQ291bnRlciA9IDA7XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0ZXh0W2NvdW50ZXJdO1xuICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZnVuYyh2YWx1ZSkpIHtcbiAgICAgICAgICAgIGNvbnRlbnRbaW5uZXJDb3VudGVyXSA9IHZhbHVlO1xuICAgICAgICAgICAgaW5uZXJDb3VudGVyKys7XG4gICAgICAgIH1cbiAgICAgICAgY291bnRlcisrO1xuICAgIH1cbiAgICByZXR1cm4gY29udGVudDtcbn1cblxuZnVuY3Rpb24gZmlsdGVyQmVmb3JlKHRleHQsIHJlZ2V4KSB7XG4gICAgY29uc3QgY29udGVudCA9IHt9O1xuICAgIGxldCBjb3VudGVyID0gMDtcbiAgICBsZXQgbWF0Y2hlZCA9IGZhbHNlO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGV4dFtjb3VudGVyXTtcbiAgICAgICAgbWF0Y2hlZCA9IHJlZ2V4LnRlc3QodmFsdWUpO1xuICAgICAgICBpZiAoIXZhbHVlIHx8IG1hdGNoZWQpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRlbnRbY291bnRlcl0gPSB2YWx1ZTtcbiAgICAgICAgY291bnRlcisrO1xuICAgIH1cbiAgICByZXR1cm4geyBtYXRjaGVkLCBjb250ZW50IH07XG59XG5cbmZ1bmN0aW9uIGZpbHRlckFmdGVyKHRleHQsIHJlZ2V4KSB7XG4gICAgY29uc3QgY29udGVudCA9IHt9O1xuICAgIGxldCBjb3VudGVyID0gMDtcbiAgICBsZXQgaW5uZXJDb3VudGVyID0gMDtcbiAgICBsZXQgc3RhcnQgPSBmYWxzZTtcbiAgICBsZXQgbWF0Y2hlZCA9IGZhbHNlO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGV4dFtjb3VudGVyXTtcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgbWF0Y2hlZCA9IHJlZ2V4LnRlc3QodmFsdWUpO1xuICAgICAgICBpZiAoIXN0YXJ0ICYmIG1hdGNoZWQpIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhcnQpIHtcbiAgICAgICAgICAgIGNvbnRlbnRbaW5uZXJDb3VudGVyXSA9IHZhbHVlO1xuICAgICAgICAgICAgaW5uZXJDb3VudGVyKys7XG4gICAgICAgIH1cbiAgICAgICAgY291bnRlcisrO1xuICAgIH1cbiAgICByZXR1cm4geyBtYXRjaGVkLCBjb250ZW50IH07XG59XG5cbmZ1bmN0aW9uIGVtcHR5Q29udGVudCgpIHtcbiAgICBjb25zdCBjb250ZW50RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lubmVyTG9nUGFuZWwnKTtcbiAgICBsZXQgaSA9IGNvbnRlbnREaXYuY2hpbGROb2Rlcy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgICBjb250ZW50RGl2LnJlbW92ZUNoaWxkKGNvbnRlbnREaXYuZmlyc3RDaGlsZCk7XG4gICAgfVxuICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gYDxjb2RlIGlkPSdjb250ZW50JyBjbGFzcz0nJHtpc1dyYXBFbmFibGVkKCkgPyAnd2hpdGUtc3BhY2Utd3JhcCcgOiAnd2hpdGUtc3BhY2UtcHJlJ30gcG9zaXRpb24tcmVsYXRpdmUnPjwvY29kZT5gO1xufVxuXG5mdW5jdGlvbiByZW5kZXJCeVBhZ2luYXRpb24oY29udGVudFRvQWRkKSB7XG4gICAgaWYgKGNvbnRlbnRUb0FkZCAmJiBPYmplY3Qua2V5cyhjb250ZW50VG9BZGQpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGZ1bGxGaWx0ZXJlZENvbnRlbnQgPSBpc0ZpbHRlckVuYWJsZWQoKSA/IGZpbHRlcmVkQ29udGVudCA6IGZ1bGxQYWdlQ29udGVudDtcbiAgICBjb25zdCB0b3RhbFJvd3MgPSBPYmplY3Qua2V5cyhmdWxsRmlsdGVyZWRDb250ZW50KS5sZW5ndGggLSAxO1xuICAgIGNvbnN0IGhlaWdodERpdiA9IGdldERlZmF1bHREaXZIZWlnaHRWYWx1ZSgpO1xuICAgIGNvbnN0IGN1cnJlbnRQb3NpdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dQYW5lbCcpLnNjcm9sbFRvcDtcbiAgICBjb25zdCByZWZlcmVuY2VSb3cgPSBNYXRoLmZsb29yKGN1cnJlbnRQb3NpdGlvbiAvIGhlaWdodERpdik7XG4gICAgLy8gaWRlbnRpZnkgcm93cyByYW5nZSB0byBkcmF3XG4gICAgbGV0IGxvd2VyUmFuZ2UgPSByZWZlcmVuY2VSb3cgLSAyNTAgPCAwID8gMCA6IHJlZmVyZW5jZVJvdyAtIDI1MDtcbiAgICBsZXQgdXBwZXJSYW5nZSA9IHJlZmVyZW5jZVJvdyArIDI1MCA+IHRvdGFsUm93cyA/IHRvdGFsUm93cyA6IHJlZmVyZW5jZVJvdyArIDI1MDtcbiAgICBsZXQgaXNQcmVwZW5kID0gZmFsc2U7XG5cbiAgICBjb25zdCBjaGlsZHJlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50JykuY2hpbGRyZW47XG4gICAgaWYgKGNoaWxkcmVuLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAvLyBpZGVudGlmeSByb3dzIHJhbmdlIHByZXNlbnQgaW4gRE9NXG4gICAgICAgIGNvbnN0IGxvd2VzdFJvd0luRE9NID0gcGFyc2VJbnQoY2hpbGRyZW4uaXRlbSgwKS5pZCk7XG4gICAgICAgIGNvbnN0IHVwcGVzdFJvd0luRE9NID0gcGFyc2VJbnQoY2hpbGRyZW4uaXRlbShjaGlsZHJlbi5sZW5ndGggLSAxKS5pZCk7XG4gICAgICAgIGlmIChsb3dlclJhbmdlIDwgbG93ZXN0Um93SW5ET00pIHtcbiAgICAgICAgICAgIGlmICh1cHBlclJhbmdlID49IGxvd2VzdFJvd0luRE9NKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlQ2hpbGRyZW4odXBwZXJSYW5nZSArIDEsIHVwcGVzdFJvd0luRE9NKTtcbiAgICAgICAgICAgICAgICB1cHBlclJhbmdlID0gbG93ZXN0Um93SW5ET00gLSAxO1xuICAgICAgICAgICAgICAgIGlzUHJlcGVuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5zdHlsZS50b3AgPSBgJHtsb3dlclJhbmdlICogaGVpZ2h0RGl2fXB4YDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZW1wdHlDb250ZW50KCk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5zdHlsZS50b3AgPSBgJHtsb3dlclJhbmdlICogaGVpZ2h0RGl2fXB4YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBleHRyYWN0Um93c1RvRHJhdyhmdWxsRmlsdGVyZWRDb250ZW50LCBsb3dlclJhbmdlLCB1cHBlclJhbmdlKTtcbiAgICAgICAgICAgIHJlbmRlcihiZWF1dGlmeUxpbmVzKGNvbnRlbnQpLCBsb3dlclJhbmdlLCBpc1ByZXBlbmQpO1xuICAgICAgICB9IGVsc2UgaWYgKHVwcGVyUmFuZ2UgPiB1cHBlc3RSb3dJbkRPTSkge1xuICAgICAgICAgICAgaWYgKGxvd2VyUmFuZ2UgPD0gdXBwZXN0Um93SW5ET00pIHtcbiAgICAgICAgICAgICAgICByZW1vdmVDaGlsZHJlbihsb3dlc3RSb3dJbkRPTSwgbG93ZXJSYW5nZSAtIDEpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50Jykuc3R5bGUudG9wID0gYCR7bG93ZXJSYW5nZSAqIGhlaWdodERpdn1weGA7XG4gICAgICAgICAgICAgICAgbG93ZXJSYW5nZSA9IHVwcGVzdFJvd0luRE9NICsgMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZW1wdHlDb250ZW50KCk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5zdHlsZS50b3AgPSBgJHtsb3dlclJhbmdlICogaGVpZ2h0RGl2fXB4YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBleHRyYWN0Um93c1RvRHJhdyhmdWxsRmlsdGVyZWRDb250ZW50LCBsb3dlclJhbmdlLCB1cHBlclJhbmdlKTtcbiAgICAgICAgICAgIHJlbmRlcihiZWF1dGlmeUxpbmVzKGNvbnRlbnQpLCBsb3dlclJhbmdlLCBpc1ByZXBlbmQpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGV4dHJhY3RSb3dzVG9EcmF3KGZ1bGxGaWx0ZXJlZENvbnRlbnQsIGxvd2VyUmFuZ2UsIHVwcGVyUmFuZ2UpO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGVudCcpLnN0eWxlLnRvcCA9IGAke2xvd2VyUmFuZ2UgKiBoZWlnaHREaXZ9cHhgO1xuICAgICAgICByZW5kZXIoYmVhdXRpZnlMaW5lcyhjb250ZW50KSwgbG93ZXJSYW5nZSwgaXNQcmVwZW5kKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RSb3dzVG9EcmF3KGNvbnRlbnQsIGZyb20sIHRvKSB7XG4gICAgY29uc3QgY29udGVudEV4dHJhY3RlZCA9IHt9O1xuICAgIGZvciAobGV0IGkgPSBmcm9tOyBpIDw9IHRvOyBpICs9IDEpIHtcbiAgICAgICAgY29udGVudEV4dHJhY3RlZFtpXSA9IGNvbnRlbnRbaV07XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50RXh0cmFjdGVkO1xufVxuXG5mdW5jdGlvbiBiZWF1dGlmeUxpbmVzKGNvbnRlbnRMaW5lcykge1xuICAgIGNvbnN0IGNvbnRlbnQgPSB7fTtcbiAgICBpZiAoT2JqZWN0LmtleXMoY29udGVudExpbmVzKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfVxuXG4gICAgY29uc3QgaGVpZ2h0RGl2ID0gZ2V0RGVmYXVsdERpdkhlaWdodFZhbHVlKCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1jb25zdFxuICAgIGZvciAobGV0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhjb250ZW50TGluZXMpKSB7XG4gICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvPC9nLCBcIiZsdDtcIikucmVwbGFjZSgvPi9nLCBcIiZndDtcIik7XG4gICAgICAgIHZhbHVlID0gaGlnaGxpZ2h0V29yZHModmFsdWUpO1xuICAgICAgICB2YWx1ZSA9IC9cXG4kLy50ZXN0KHZhbHVlKSA/IHZhbHVlIDogYCR7dmFsdWV9XFxuYDtcbiAgICAgICAgY29udGVudFtrZXldID0gYDxkaXYgaWQ9XCIke2tleX1cIiBzdHlsZT1cIm1pbi1oZWlnaHQ6ICR7aGVpZ2h0RGl2fXB4XCI+JHt2YWx1ZX08L2Rpdj5gO1xuICAgIH1cbiAgICByZXR1cm4gY29udGVudDtcbn1cblxuZnVuY3Rpb24gaGlnaGxpZ2h0V29yZHMocm93KSB7XG4gICAgaWYgKCFzY2hlbWFDb2xvcnMpIHtcbiAgICAgICAgcmV0dXJuIHJvdztcbiAgICB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9wcmVmZXItZm9yLW9mXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY2hlbWFDb2xvcnMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgY29uc3QgcnVsZSA9IHNjaGVtYUNvbG9yc1tpXTtcbiAgICAgICAgY29uc3QgcmVnZXhwID0gbmV3IFJlZ0V4cChydWxlLnJlZ2V4LCBcImdpXCIpO1xuICAgICAgICBpZiAocmVnZXhwLnRlc3Qocm93KSkge1xuICAgICAgICAgICAgcm93ID0gcm93LnJlcGxhY2VBbGwocmVnZXhwLCByZXBsKTtcbiAgICAgICAgICAgIHJvdyA9IHJvdy5yZXBsYWNlQWxsKCcjcnVsZUNvbG9yJywgcnVsZS5jb2xvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJvdztcbn1cblxuZnVuY3Rpb24gcmVwbCgpIHtcbiAgICBjb25zdCBtYXRjaCA9IGFyZ3VtZW50c1swXTtcbiAgICBjb25zdCBvZmZzZXQgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDJdO1xuICAgIGNvbnN0IG9yaWdpbmFsU3RyaW5nID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXTtcbiAgICBpZiAoIW9yaWdpbmFsU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBtYXRjaDtcbiAgICB9XG4gICAgY29uc3QgaW5kZXhPcGVuU3BhbiA9IG9yaWdpbmFsU3RyaW5nLnN1YnN0cmluZygwLCBvZmZzZXQgKyBtYXRjaC5sZW5ndGgpLmxhc3RJbmRleE9mKFwiPHNwYW5cIik7XG4gICAgY29uc3QgaW5kZXhDbG9zZVNwYW4gPSBvcmlnaW5hbFN0cmluZy5zdWJzdHJpbmcoMCwgb2Zmc2V0ICsgbWF0Y2gubGVuZ3RoKS5sYXN0SW5kZXhPZihcIjwvc3Bhbj5cIik7XG4gICAgaWYgKGluZGV4T3BlblNwYW4gPT09IC0xIHx8IGluZGV4T3BlblNwYW4gPCBpbmRleENsb3NlU3Bhbikge1xuICAgICAgICByZXR1cm4gYDxzcGFuIGNsYXNzPVwiI3J1bGVDb2xvclwiPiR7bWF0Y2h9PC9zcGFuPmA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlQ2hpbGRyZW4oZnJvbSwgdG8pIHtcbiAgICBpZiAodG8gPCBmcm9tKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChsZXQgaT1mcm9tOyBpPD10bzsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRvRGVsZXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaS50b1N0cmluZygpKTtcbiAgICAgICAgaWYgKHRvRGVsZXRlKSB7XG4gICAgICAgICAgICB0b0RlbGV0ZS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVuZGVyKGNvbnRlbnQsIGZyb20sIHByZXBlbmQpIHtcbiAgICBpZiAoT2JqZWN0LmtleXMoY29udGVudCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKS5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQoJ05vIGxvZ3MgLi4uJyk7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50JykuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnRUb0Rpc3BsYXkgPSBjb25jYXRlbmF0ZU9iamVjdFZhbHVlc0FzU3RyaW5nKGNvbnRlbnQsIGZyb20pO1xuICAgICAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCkuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KGNvbnRlbnRUb0Rpc3BsYXkpO1xuICAgICAgICBpZiAocHJlcGVuZCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5wcmVwZW5kKGZyYWdtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50JykuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1RvQm90dG9tKSB7XG4gICAgICAgICAgICBzY3JvbGxUb0JvdHRvbSgpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjb25jYXRlbmF0ZU9iamVjdFZhbHVlc0FzU3RyaW5nKG9iamVjdCwgaXgpIHtcbiAgICBsZXQgdmFsdWVzQ29uY2F0ZW5hdGVkID0gJyc7XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBvYmplY3RbaXhdO1xuICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB2YWx1ZXNDb25jYXRlbmF0ZWQgKz0gdmFsdWU7XG4gICAgICAgIGl4Kys7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZXNDb25jYXRlbmF0ZWQ7XG59XG5cbmZ1bmN0aW9uIHNjcm9sbFRvQm90dG9tKCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3R0b20nKS5zY3JvbGxJbnRvVmlldygpO1xufVxuXG5mdW5jdGlvbiBnZXRDb250YWluZXIoKSB7XG4gICAgY29uc3QgY29udGFpbmVyc1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXJzLXNlbGVjdCcpO1xuICAgIGlmIChjb250YWluZXJzU2VsZWN0KSB7XG4gICAgICAgIHJldHVybiBjb250YWluZXJzU2VsZWN0LnZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gZGVmYXVsdENvbnRhaW5lcjtcbn1cblxuZnVuY3Rpb24gaXNGb2xsb3coKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xsb3ctY2hrJykuY2hlY2tlZDtcbn1cblxuZnVuY3Rpb24gZ2V0U2luY2VEdXJhdGlvbigpIHtcbiAgICBjb25zdCBzaW5jZVR5cGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2luY2Utc2VsZWN0JykudmFsdWU7XG4gICAgY29uc3Qgc2luY2VJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaW5jZS1pbnB1dCcpLnZhbHVlO1xuICAgIGlmIChpc05hTihzaW5jZUlucHV0KSB8fCBzaW5jZUlucHV0IDw9IDAgfHwgc2luY2VUeXBlLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHJldHVybiBgJHtzaW5jZUlucHV0fSR7c2luY2VUeXBlfWA7XG59XG5cbmZ1bmN0aW9uIGdldFRhaWwoKSB7XG4gICAgY29uc3QgdGFpbFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhaWwtaW5wdXQnKS52YWx1ZTtcbiAgICBpZiAoaXNOYU4odGFpbFZhbHVlKSB8fCB0YWlsVmFsdWUgPD0gMCkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIHJldHVybiB0YWlsVmFsdWU7XG59XG5cbmZ1bmN0aW9uIGdldFRvVGVybWluYWwoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZXJtaW5hbC1jaGsnKS5jaGVja2VkO1xufVxuXG5mdW5jdGlvbiBpc1dyYXBFbmFibGVkKCkge1xuICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd3JhcC1jaGsnKS5jaGVja2VkO1xufVxuXG5mdW5jdGlvbiBnZXREZWZhdWx0RGl2SGVpZ2h0VmFsdWUoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xsb3ctbGJsJykub2Zmc2V0SGVpZ2h0O1xufVxuXG4oZnVuY3Rpb24gKCkge1xuICAgIGluaXQoKTtcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n")}]);